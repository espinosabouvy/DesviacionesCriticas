{
    "collab_server" : "",
    "contents" : "#despues de tener la tabla dinamica que sale del sistema de tiempos - estilos habilitados\n#se debe separar en archivos por departamento y dejar la tabla con el formato\n#estilo - familia - puesto1 - puesto2 - puestox\n\npreparar <- function(exportar = FALSE){\n     require(dplyr)\n     require(tidyr)\n     \n     #el formato inicial es\n     #limpiar el formato, actual (LINEA, VCESTIL, PARES, FAMPESP, FAMMONT, DEPTO, FUNCION, TIEMPO,\n     #PERSONAS, META)\n\n     tiempos.raw <- read.csv(\"FUNCIONES_ESTILOS_HABILITADOS.csv\", stringsAsFactors = TRUE)\n     \n     deptos.usar <- c(\"CORTE\",\"CORTE Y PREPARA\", \"FAMILIA\", \"FORRADOS\", \"PLANTA\", \"RAYADO Y RESACA\",\n                      \"SUELA\")\n     \n     tiempos.raw <- tiempos.raw%>%\n          select(DEPTO, VCESTIL, FAMPESP, FUNCION, TIEMPO)%>%\n          filter(DEPTO %in% deptos.usar)%>%\n          filter(TIEMPO > 0)\n     \n     \n     #agrupar pespuntadores y preliminares\n     tiempos.raw$FUNCION <- ifelse(grepl(\"PESPUNTADOR\", \n                                         tiempos.raw$FUNCION),\"PESPUNTADOR\",\n                                   paste(tiempos.raw$FUNCION))\n     tiempos.raw$FUNCION <- ifelse(grepl(\"CA-PES\", \n                                         tiempos.raw$FUNCION),\"PESPUNTADOR\",\n                                   paste(tiempos.raw$FUNCION))\n     tiempos.raw$FUNCION <- ifelse(grepl(\"PRELIM\", \n                                         tiempos.raw$FUNCION),\"PRELIMINAR\",\n                                   paste(tiempos.raw$FUNCION))\n     tiempos.raw$FUNCION <- ifelse(grepl(\"CA-PRE\", \n                                         tiempos.raw$FUNCION),\"PRELIMINAR\",\n                                   paste(tiempos.raw$FUNCION))\n     tiempos.raw$FUNCION <- ifelse(grepl(\"C-PREA\", \n                                         tiempos.raw$FUNCION),\"PRELIMINAR\",\n                                   paste(tiempos.raw$FUNCION))\n     tiempos.raw$FUNCION <- ifelse(grepl(\"CA-COR\", \n                                         tiempos.raw$FUNCION),\"CORTADOR PIEL\",\n                                   paste(tiempos.raw$FUNCION))\n     tiempos.raw$FUNCION <- ifelse(grepl(\"CORTADOR FLASH\", \n                                         tiempos.raw$FUNCION),\"CORTADOR PIEL\",\n                                   paste(tiempos.raw$FUNCION))\n     tiempos.raw$FUNCION <- ifelse(grepl(\"PRECONF\", \n                                         tiempos.raw$FUNCION),\"PRECONFORMADOR\",\n                                   paste(tiempos.raw$FUNCION))\n     tiempos.raw$FUNCION <- ifelse(grepl(\"CA-PREC\", \n                                         tiempos.raw$FUNCION),\"PRECONFORMADOR\",\n                                   paste(tiempos.raw$FUNCION))\n     tiempos.raw$FUNCION <- ifelse(grepl(\"CA-DOB\", \n                                         tiempos.raw$FUNCION),\"DOBLILLADOR\",\n                                   paste(tiempos.raw$FUNCION))\n     tiempos.raw$FUNCION <- ifelse(grepl(\"CA-REB\", \n                                         tiempos.raw$FUNCION),\"REBAJADOR\",\n                                   paste(tiempos.raw$FUNCION))\n     tiempos.raw$FUNCION <- ifelse(grepl(\"REBAJADOR PIEL\", \n                                         tiempos.raw$FUNCION),\"REBAJADOR\",\n                                   paste(tiempos.raw$FUNCION))\n     tiempos.raw[tiempos.raw$FUNCION == \"FORRAR\" & tiempos.raw$DEPTO == \"PLANTA\",]$FUNCION <- \"RIBETEAR\"\n     \n     #quitar comodines\n     tiempos.raw <- tiempos.raw[!grepl(\"COMODIN+\",  tiempos.raw$FUNCION),]\n     names(tiempos.raw) <- make.names(names(tiempos.raw))\n     tiempos <<- tiempos.raw%>%\n          select(DEPTO, \"ESTILO\" = VCESTIL, FAMPESP, FUNCION, \"TIEMPO\" = TIEMPO)\n     \n     \n     #completar con cero las funciones que existen en cada depto y el estilo no las tiene\n     #primero se debe agregar todos los estilos a todas los deptos\n     \n     estilos.fam <<- unique(tiempos[tiempos$DEPTO == \"FAMILIA\",2:3])%>%\n          mutate(\"NUEVO\" = paste0(\"SKU-\", n()))%>%\n          select(\"ESTILO\" = NUEVO, FAMPESP)\n     \n     #hacer esto cuando se seleccione el depto\n     for(i in unique(tiempos$DEPTO)){\n          temp <- tiempos%>%\n                    filter(DEPTO == i)%>%\n                    select(ESTILO, FUNCION, TIEMPO)%>%\n                    group_by(ESTILO, FUNCION)%>%\n                    summarise(\"TIEMPO\" = sum(TIEMPO))%>%\n                    spread(FUNCION,TIEMPO, drop = FALSE, fill = 0)\n          result <<- merge(estilos.fam, temp, by = \"ESTILO\")\n          \n          if (exportar){\n               write.csv(result, paste0(i, \".csv\"), row.names = F)\n          }\n     }\n}\n",
    "created" : 1493157919325.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "2786918552",
    "id" : "1CEA60A6",
    "lastKnownWriteTime" : 1491397207,
    "last_content_update" : 1491397207,
    "path" : "~/Perugia/modelos-criticos/script.R",
    "project_path" : "script.R",
    "properties" : {
    },
    "relative_order" : 1,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_source"
}